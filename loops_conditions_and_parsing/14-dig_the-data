#!/usr/bin/env bash
# This script groups visitors by IP and HTTP status code from an Apache log file

# Check if the log file exists
if [[ ! -f apache-access.log ]]; then
    echo "Log file is empty."
    exit 0
fi

# Parse the log file
awk '
    # Check for valid lines
    $0 ~ /^[^ ]+ [^ ]+ [^ ]+ / {
        ip[$1][$9]++
    }
    END {
        # Check for empty log scenario
        if (length(ip) == 0) {
            print "Log file is empty."
            exit
        }
        # Print occurrences and sort by occurrences
        for (i in ip) {
            for (j in ip[i]) {
                print ip[i][j], i, j
            }
        }
    }
' apache-access.log | sort -nr | awk '{print $0}'
