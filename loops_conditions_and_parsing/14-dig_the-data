#!/usr/bin/env bash
# This script groups visitors by IP and HTTP status code from an Apache log file.

# Check if the log file exists
if [[ ! -f apache-access.log ]]; then
    echo "Log file is empty."
    exit 0
fi

# Parse the log file and group by IP and HTTP status code
awk '
    # Process each valid log entry
    /^[^ ]+ [^ ]+ [^ ]+/ {
        count[$1][$9]++
    }
    END {
        # Print the occurrence number, IP, and HTTP code
        for (ip in count) {
            for (code in count[ip]) {
                print count[ip][code], ip, code
            }
        }
    }
' apache-access.log | sort -nr | awk '{print $0}'
